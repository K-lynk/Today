<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Today</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#000; color:#fff; display:flex; flex-direction:column; height:100vh; }
  header { text-align:center; padding:15px; font-size:24px; font-weight:bold; border-bottom:1px solid #444; }
  #timer { text-align:center; font-size:20px; margin:10px 0; }
  #progress-bar-container { height:6px; background:#333; margin:0 10px 10px 10px; border-radius:3px; }
  #progress-bar { height:100%; width:0%; background:red; border-radius:3px; transition:width 0.3s; }
  #task-list { flex:1; overflow-y:auto; padding:0 10px; }
  .task { display:flex; align-items:center; justify-content:flex-start; padding:8px; border-bottom:1px solid #444; word-wrap:break-word; }
  .task input[type=checkbox] { margin-right:10px; }
  .task .star { cursor:pointer; color:gray; margin-left:auto; }
  .task .star.active { color:red; }
  #input-bar { display:flex; padding:10px; border-top:1px solid #444; background:#111; }
  #task-input { flex:1; padding:8px; font-size:14px; }
  #add-btn { margin-left:8px; padding:8px 14px; cursor:pointer; }
</style>
</head>
<body>
<header>Today</header>
<div id="timer"></div>
<div id="progress-bar-container"><div id="progress-bar"></div></div>
<div id="task-list"></div>
<div id="input-bar">
  <input type="text" id="task-input" placeholder="Add a task">
  <button id="add-btn">Add</button>
</div>
<script>
const taskList = document.getElementById('task-list');
const taskInput = document.getElementById('task-input');
const addBtn = document.getElementById('add-btn');
const progressBar = document.getElementById('progress-bar');

// Check date-based reset
const todayDate = new Date().toDateString();
const savedDate = localStorage.getItem('todayDate');
if(savedDate !== todayDate){
  localStorage.removeItem('todayTasks');
  localStorage.setItem('todayDate', todayDate);
}

let tasks = JSON.parse(localStorage.getItem('todayTasks')||'[]');

function saveTasks(){
  localStorage.setItem('todayTasks', JSON.stringify(tasks));
}

function updateProgress(){
  const completed = tasks.filter(t=>t.completed).length;
  const percent = tasks.length ? (completed/tasks.length)*100 : 0;
  progressBar.style.width = percent+'%';
}

function renderTasks(){
  taskList.innerHTML='';
  tasks.sort((a,b)=>b.priority-a.priority);
  tasks.forEach((t,i)=>{
    const div = document.createElement('div');
    div.className='task';
    const checkbox = document.createElement('input');
    checkbox.type='checkbox';
    checkbox.checked = t.completed;
    checkbox.addEventListener('click',()=>{
      t.completed = checkbox.checked;
      saveTasks();
      updateProgress();
      if(t.completed) div.style.textDecoration='line-through';
      else div.style.textDecoration='none';
      if (navigator.vibrate) navigator.vibrate(50);
    });
    if(t.completed) div.style.textDecoration='line-through';
    const span = document.createElement('span');
    span.textContent = t.text;
    span.style.textAlign='left';
    const star = document.createElement('span');
    star.className='star'+(t.priority?' active':'');
    star.textContent='â˜…';
    star.addEventListener('click',()=>{
      t.priority = t.priority?0:1;
      saveTasks();
      renderTasks();
    });
    div.appendChild(checkbox);
    div.appendChild(span);
    div.appendChild(star);
    div.addEventListener('click', (e)=>{ if(e.target!==checkbox && e.target!==star){ taskList.removeChild(div); tasks.splice(i,1); saveTasks(); updateProgress(); }});
    taskList.appendChild(div);
  });
  updateProgress();
}

function addTask(){
  const text = taskInput.value.trim();
  if(!text) return;
  tasks.push({text, completed:false, priority:0});
  taskInput.value='';
  saveTasks();
  renderTasks();
}

addBtn.addEventListener('click', addTask);
taskInput.addEventListener('keypress',e=>{if(e.key==='Enter') addTask();});

function updateTimer(){
  const now = new Date();
  const end = new Date(); end.setHours(24,0,0,0);
  const diff = end - now;
  const hrs = Math.floor(diff/3600000);
  const mins = Math.floor((diff%3600000)/60000);
  const secs = Math.floor((diff%60000)/1000);
  document.getElementById('timer').textContent=`${hrs}h ${mins}m ${secs}s left today`;
}
setInterval(updateTimer,1000);

renderTasks();
updateTimer();
</script>
</body>
</html>